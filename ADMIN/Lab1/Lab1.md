# Лабораторная работа 1: Пользовательские и групповые учетные записи. Пользовательские профили.

### Упражнение 1.1. Создание учетных записей пользователя и группы.

1. Создайте пользовательскую учетную запись *vinnie*. Зафиксируйте команду и поведение системы при создании пользовательской учетной записи.
   
   Создать учетную запись *vinnie* можно используя команду **useradd**:
    
    ```console
    root@bc30138:~$ useradd vinnie 
    ```

2. Задайте пользовательскую информацию (GECOS) для учетной записи *vinnie*.
   
   Для того чтобы задать пользовательскую информацию нужно зайти в файл **/etc/passwd**, найти поле учетной *vinnie* и изменить его:

    ```console
    vinnie:x:1003:1003:,,,:/home/vinnie:/bin/bash 
    ```

    В данный момент в GECOS (информационное поле пользователя) *vinnie* отсутствует информация. Заполним его:

    ```console
    vinnie:x:1003:1003:Winnie-the-Pooh,Forest,8(812)1234567,8(812)1234567, Bear:/home/vinnie:/bin/bash 
    ```

    Теперь медведь (Bear) по имени Винни-Пух (Winnie-the-Pooh) проживает в лесу (Forest) и его номер телефона (и домашний, и сотовый) 8(812)1234567.

3. Задайте начальный пароль (по вашему усмотрению) для учетной записи *vinnie*.

    Для того чтобы установить (или сменить пароль) пользователя можно применить команду **passwd*:

    ```console
    root@bc30138:~$ passwd vinnie
    Enter new UNIX password:
    Retype new UNIX password:
    passwd: password updated successfully 
    ```

4. Создайте групповую учетную запись *vgroup*.
   
   Группу можно создать с помощью команды **groupadd**:

    ```console
    root@bc30138:~$ groupadd vgroup
    ```
    
5. Включите пользователя *vinnie* в группу *vgroup*.
    
    Для того чтобы добавить пользователя *vinnie* в группу *vgroup* изменим строку в файле **/etc/groups**:

    ```console
    vgroup:x:1004:
    ```

    На:

    ```console
    vgroup:x:1004:vinnie
    ```

    Также это можно сделать с помощью командной строки (однако для этого требуются права администратора):

    ```console
    root@bc30138:~$ usermod -a -G vgroup vinnie
    ```

### Упражнение 1.2. Тестирование созданной учетной записи пользователя.

1. Войдите в систему под учетной записью *vinnie*.
    
    Выйти из учетной записи *root* можно с помощью команды **logout**:

    ```console
    root@bc30138:~$ logout
    ```

    На входе в систему используем логин: vinnie и пароль, который мы указали для этого пользователя. 

2. Зафиксируйте значения идентификаторов UID, GID полученного пользователя.
   
   Для того чтобы узнать UID и GID полученного пользователя используем команду **id**:

    ```console
    vinnie@bc30138:~$ id
    uid=1003(vinnie) gid=1003(vinnie) groups=1003(vinnie),1004(vgroup) 
    ```

3. Измените начальный интерпретатор пользователя на **csh**.

    Для того чтобы изменить начальный интерпретатор **bash** на **csh** требуется внести изменения в файле **/etc/passwd** , но для этого требуются права **root**. Сменим пользователя используя команду **su** (обратите внимание, что мы оказались в домашней директории пользователя vinnie):

     ```console
    vinnie@bc30138:~$ su root
    Password:
    root@bc30138:~/home/vinnie$
    ```

    На данной системе не был установлен интерпретатор **csh**, поэтому его пришлось установить:

    ```console
    root@bc30138:~/home/vinnie$ apt-get install csh
    ```

    Для того чтобы сменить интерпретатор изменим строку в файле **/etc/passwd**:

    ```console
    vinnie:x:1003:1003:Winnie-the-Pooh,Forest,8(812)1234567,8(812)1234567, Bear:/home/vinnie:/bin/bash 
    ```

    На: 

    ```console
    vinnie:x:1003:1003:Winnie-the-Pooh,Forest,8(812)1234567,8(812)1234567, Bear:/home/vinnie:/bin/csh
    ```

    Также это можно сделать используя командную строку:

    ```console
    vinnie@bc30138:~$ chsh -s /bin/csh vinnie
    Password:
    vinnie@bc30138:~$ 
    ```

4. Выйдите из системы и войдите в систему под учетной записью *vinnie*, проследите за изменениями.

    После того как мы перезашли в систему под учетной записью *vinnie* можем наблюдать во-первых, что изменилось первичное приглашение командного интерпретатора:

    ```console
    %
    ```

    Проверим какой интерпретатор сейчас используется: 

    ```console
    % echo $SHELL 
    /bin/csh
    ```

5. Измените начальный интерпретатор пользователя *vinnie* на **bash**.

    Зайдем в систему под пользователем  *root* (большинство команд csh те же самые, что и у bash, поэтому это не составит труда) и изменим строку из пункта 3 обратно на:

    ```console
    vinnie:x:1003:1003:Winnie-the-Pooh,Forest,8(812)1234567,8(812)1234567, Bear:/home/vinnie:/bin/bash 
    ```

    Вариант из командной строки: 

    ```console
    % chsh -s /bin/csh vinnie
    Password:
    % 
    ```
### Упражнение 1.3. Изменение и тестирование политики учетной записи пользователя.

1. Задайте следующую политику учетной записи *vinnie*:
    - Минимальное время действия пароля: **0 дней**
    - Максимальное время действия пароля: **10 дней**
    - Дата последней смены пароля: **по умолчанию**
    - Количество дней, за которое, до окончания срока действия пароля, предупреждается пользователь: **7 дней**
    - Количество дней после окончания срока действия пароля, в течение которого разрешено пользоваться учетной записью: **3 дня**
    - Время истечения учетной записи пользователя: **никогда не истекает**
    
    Чтобы посмотреть политику учетной записи *vinnie* используем команду **chage**:

    ```console
	root@bc30138:~$ chage -l vinnie
    Last password change                    : Nov 8, 2018
    Password expires                        : never
    Password inactive                       : never
    Account expires                         : never
    Minimum number of days between password change        : 0
    Maximum number of days between password change        : 99999
    Number of days of warning before password expires     : 7
    ```

    Нужную политику можно установить с помощью параметров команды **chage**, а также изменив файл **/etc/shadow**. Изменим строку в **/etc/shadow**:
    ```console
    vinnie:<много символов>:17850:0:99999:7:::
    ```
    На (чтобы установить параметр на значение never достаточно просто оставить поле пустым):
    ```console
    vinnie:<много символов>:17850:0:10:7:3::
    ```
    
    Тоже самое, но с использованием команды **chage**:

    ```console
    root@bc30138:~$ chage -m 0 -M 10 -W 7 -I 3 vinnie
    ```

    Проверим:
     ```console
	root@bc30138:~$ chage -l vinnie
    Last password change                    : Nov 8, 2018
    Password expires                        : never
    Password inactive                       : never
    Account expires                         : never
    Minimum number of days between password change        : 0
    Maximum number of days between password change        : 10
    Number of days of warning before password expires     : 7
    ```

    Однако с помощью этой команды не выводится количество дней после окончания срока действия пароля, в течение которого разрешено пользоваться учетной записью. 

2. Задайте дату последней смены пароля учетной записи *vinnie*: **6 дней назад**. (Пароль пользователя еще не истек, но напоминание уже работает).
    
    Изменение даты удобнее производить с помощью параметров команды **chage**, так как в **/etc/shadow** даты выставляются в виде количества дней прошедших с 1ого января 1970ого года:
    ```console
    root@bc30138:~$ chage -d 2018-11-02 vinnie (например) 
    ```

3. Войдите в систему под учетной записью *vinnie*. Проследите за сообщением от системы.
   
   Вышло предупреждение:
    ```console
	WARNING: Your password will inspire in 5 days
    ```

4. Задайте дату последней смены пароля учетной записи *vinnie*: **11 дней назад**. (Пароль пользователя уже истек, но еще разрешено пользоваться учетной записью).

    ```console
    root@bc30138:~$ chage -d 2018-10-28 vinnie
    ```
5. Войдите в систему под учетной записью *vinnie*. Проследите за сообщением от системы.
    
    Система оповестит, что действие вашего пароля истекло и принудит сменить пароль прямо сейчас не дав пользователю доступа.

    ```console
    You are required to change your password immediately (password aged) 
    Changing password for vinnie 
    (current) UNIX password:
    Enter new UNIX password:
    Retype new UNIX password:
    ```

6. Задайте дату последней смены пароля учетной записи *vinnie*: **14 дней назад**. (Пароль пользователя уже истек, и уже не разрешено пользоваться учетной записью):

    ```console
    root@bc30138:~$ chage -d 2018-10-25 vinnie
    ```

7. Войдите в систему под учетной записью *vinnie*. Проследите за сообщением от системы.
   
   Система очень быстрым кадром написала ошибку и тут же запустила ввод логина заново, тем самым полностью отказав пользователю в доступе.

8. Задайте политику учетной записи пользователя *vinnie* так, чтобы пароль не истекал никогда.
    
    Это можно сделать двумя способами (акцентируется внимание именно на этом пункте, так как не очевидно как должно выглядеть вводимое поле, чтобы задать бесконечное значение параметра).

    - Оставить поле максимального количества дней без смены пароля в **/etc/shadow** не заполненным (смотри пункт 1):
    ```console
    vinnie:<много символов>:17850:0::7:3::
    ```
    - В команде **chage** установить значение **-1** для параметра **-M**: 
    ```console
    chage -M -1 vinnie
    ```
### Упражнение 1.4. Настройка общесистемного профиля пользователей.

1. Измените общесистемный профиль для интерпретатора **bash** так, чтобы:
    
    a. при каждом входе в систему производился вывод информации о текущих работающих пользователях и времени работы системы, прошедшего от ее запуска.

    b. первичное приглашение командного интерпретатора (значение переменной PS1).

    Изменим содержимое файла **/etc/bash.bashrc**
    Добавим следующую строку (пункт a): 
    ```console
    w
    ``` 

    Изменим строку (пункт b):
    ```console
    PS1 = '${debian_chroot:+($debian_chroot)}\u@\h:\w$ '
    ``` 

    Например таким образом (поменяли \u (имя пользователя) и \h (имя системы) местами и добавили перед :\w (\wдиректория в которой мы находимся) следующие символы: "-PS1-changed"):
    ```console
    PS1 = '${debian_chroot:+($debian_chroot)}\h@\u-PS1-changed:\w$ '
    ``` 

2. Выйдите из системы и войдите в систему, проследите за изменениями.

    При входе в систему будет выведена на экран подобная таблица (На данной системе на момент входа авторизованы два пользователя):
    ```console
     15:27:22 up 44 min, 2 users, load average: 0.00, 0.00, 0.00
    USER    TTY     FROM        LOGIN@  IDLE    JCPU    PCPU    WHAT
    vinnie  tty1    -           15:00   10.00s  0.04s   0.03s   -bash
    root    tty2    -           15:27   2.00s   0.03s   0.00s   w
    ```

    Первичное приглашение командного интерпретатора теперь выглядит несколько иначе (из эстетических соображений далее первичное приглашение изменено на стандартное):

    ```console
    bc30138@root-PS1-changed:~$ 
    ```

    



